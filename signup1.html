<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
  
     <link rel="stylesheet" href="style.css"/>


    <script type="module">

    // Import the functions you need from the SDKs you need

    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-analytics.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/12.5.0/firebase-firestore.js";


    // TODO: Add SDKs for Firebase products that you want to use

    // https://firebase.google.com/docs/web/setup#available-libraries


    // Your web app's Firebase configuration

    // For Firebase JS SDK v7.20.0 and later, measurementId is optional

    const firebaseConfig = {

        apiKey: "AIzaSyDpevND_wFdc4ecj0SdSRjBrsnh_Tl6OS8",

        authDomain: "durhackx.firebaseapp.com",

        projectId: "durhackx",

        storageBucket: "durhackx.firebasestorage.app",

        messagingSenderId: "563104646617",

        appId: "1:563104646617:web:904574d136dced668d85c8",

        measurementId: "G-5KBFJMC4D1"

    };


    // Initialize Firebase

    const app = initializeApp(firebaseConfig);

    const analytics = getAnalytics(app);

    const auth = getAuth(app);

    const db = getFirestore(app);

    window.printPlace = function() {
        console.log(place_id);
    }

    window.signUp = async function() {
        const name = document.getElementById("nameInput").value
        const email = document.getElementById("emailInput").value
        const password = document.getElementById("passwordInput").value
        const place_id = document.getElementById("postcodeInput").value
        if(!name || !email || !password || !place_id) {
            alert("Please enter all fields!")
            return;
        }
        try {
            const userCredential = await createUserWithEmailAndPassword(auth, email, password);
            await setDoc(doc(db, "users", userCredential.user.uid), {
                name,
                email,
                place_id,
                createdAt: new Date()
            });
            
            window.location.href='profile.html';
        }
        catch {
            alert("Sign up failed! Have you already signed up with this email address?")
        }
        

    }  

    window.Testing = async function() {
            alert("Testing");
        } 
    </script>

</head>
  <body id="signUpBody">
    <nav>
        <a href="profile.html"><img src="profile.jpg" class="navbarProfile"/></a>
        <a href="messages.html"><img src="messages.png"class="navbarMessages"/></a>
        <a href="matchingPage.html"><img src="matches.png"class="navbarMatches"/></a>
    </nav>
        <form>
        <div id="leftSide">
                <div class="form-group-middle">
                    <label for="exampleInputEmail1">Name</label>
                    <input type="text" class="form-control" id="nameInput" aria-describedby="emailHelp" placeholder="Enter name">
                </div>
                <div class="form-group-middle">
                    <label for="exampleInputEmail1">Email address</label>
                    <input type="email" class="form-control" id="emailInput" aria-describedby="emailHelp" placeholder="Enter email">
                    <small id="emailHelp" class="form-text text-muted">We'll never share your email with anyone else.</small>
                </div>
            </div>

            <div id="rightSide">
                <div class="form-group-middle">
                    <label for="exampleInputPassword1">Password</label>
                    <input type="password" class="form-control" id="passwordInput" placeholder="Password">
                </div>
                <div class="form-group-middle">
                    <label for="exampleInputPostcode1">Postcode</label>
                    <input type="text" class="form-control" id="postcodeInput" placeholder="Postcode">
                </div>
            </div>
           
            <button id="signButton" type="button" class="btn btn-primary middle" onclick="signUp()">Sign Up</button>
        </form>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js" integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI" crossorigin="anonymous"></script>

    <script 
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyARPrfzTMcxnHvu__CW1u5tuxV11xx0pf0&loading=async&libraries=places&callback=initAutocomplete">
        async
        defer
    </script>

    <script>

    let autocomplete;
    var place_id;


    function initAutocomplete() {
        autocomplete = new google.maps.places.Autocomplete(
        document.getElementById('autocomplete'),
        {
            types: ['geocode'],
            componentRestrictions: { country: 'uk' }, // optional
        }
        );

        autocomplete.addListener('place_changed', () => {
        place_id = autocomplete.getPlace().place_id;
        printPlace();


        /*const place = autocomplete.getPlace();
        console.log('Place ID:', place.place_id);
        console.log('Selected address:', place.formatted_address);
        console.log('Coordinates:', place.geometry.location.lat(), place.geometry.location.lng());*/
        });
    }

    window.onload = initAutocomplete;
    </script>
</body>

</html>